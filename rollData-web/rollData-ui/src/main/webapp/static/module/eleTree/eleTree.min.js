layui.define(["jquery","laytpl","contextMenu","layer","setter"],function(e){function p(n,e,t){var r=JSON.stringify(n.diyHoverNodeTypes);return["{{# for(var i=0;i<d.length;i++){ }}",'<div class="eleTree-node" data-'+n.request.key+'="{{d[i]["'+n.request.key+'"]}}" eletree-floor="'+e+'" style="display: none;">','<div class="eleTree-node-content" style="padding-left: '+n.indent*e+'px;">','<span class="eleTree-node-content-icon">','<i class="layui-icon layui-icon-triangle-r ',n.lazy?['{{# if(d[i]["'+n.request.isLeaf+'"]){ }}','lazy-icon" ></i>',"{{# }else{ }}",'leaf-icon" style="color: transparent;" ></i>',"{{# } }}"].join(""):['{{# if(!d[i]["'+n.request.children+'"] || d[i]["'+n.request.children+'"].length===0 || !d[i]["'+n.request.children+'"][0]){ }}','leaf-icon" style="color: transparent;"',"{{# } }}",'"></i>'].join(""),"</span>",function(){if(n.showIcon)return['<span class="eleTree-node-content-icon eletreefont-special ','{{# if(d[i]["icon"] || !d[i]["'+n.request.children+'"] || d[i]["'+n.request.children+'"].length===0 || !d[i]["'+n.request.children+'"][0]){ }}','{{ d[i]["icon"] }}',"{{# }else{ }}",n.nodeIcon.close,"{{# } }}",'"></span>'].join("")}(),function(){if(n.showCheckbox){var e="";return e="1"===t?'"1" checked':"2"===t?'"2"':'"0"',['{{# if(d[i]["'+n.request.checked+'"]) { }}','<input type="checkbox" name="eleTree-node" eleTree-status="1" checked class="eleTree-hideen ',"{{# }else{ }}",'<input type="checkbox" name="eleTree-node" eleTree-status='+e+' class="eleTree-hideen ',"{{# } }}",'{{# if(d[i]["'+n.request.disabled+'"]) { }}',"eleTree-disabled","{{# } }}",'" />'].join("")}return""}(),'<span class="eleTree-node-content-label '+(n.diyHoverDom?"pr-25":"")+'">{{d[i]["'+n.request.name+'"]}}</span>',n.diyHoverDom?"function"==typeof n.diyHoverDom?n.diyHoverDom():"string"==typeof n.diyHoverDom?n.diyHoverNodeTypes&&n.diyHoverNodeTypes.length?["{{# if( "+r+'.indexOf(d[i]["type"]) >= 0) { }}','<span class="eleTree-node-content-diydom iconfont '+n.diyHoverDom+" "+(n.diyHoverDomIconShow?"":"eleTree-hide")+'"></span>',"{{# }else{ }}","","{{# } }}"].join(""):'<span class="eleTree-node-content-diydom iconfont '+n.diyHoverDom+" "+(n.diyHoverDomIconShow?"":"eleTree-hide")+'"></span>':n.diyHoverNodeTypes&&n.diyHoverNodeTypes.length?["{{# if( "+r+'.indexOf(d[i]["type"]) >= 0) { }}','<span class="eleTree-node-content-diydom iconfont icon-guanli '+(n.diyHoverDomIconShow?"":"eleTree-hide")+'"></span>',"{{# }else{ }}","","{{# } }}"].join(""):'<span class="eleTree-node-content-diydom iconfont icon-guanli '+(n.diyHoverDomIconShow?"":"eleTree-hide")+'"></span>':"","</div>",'<div class="eleTree-node-group">',"</div>","</div>","{{# } }}"].join("")}function r(){return'<h3 class="eleTree-noText" style="text-align: center;height: 30px;line-height: 30px;color: #888;">{{d.emptText}}</h3>'}var q=layui.jquery,T=layui.laytpl,o=layui.hint(),l=layui.contextMenu,x="eleTree",n={on:function(e,n){return layui.onevent.call(this,x,e,n)},render:function(e){var n=new i(e);return t.call(n)}},t=function(){var t=this,r=t.config;return{updateKeyChildren:function(e,n){if(0!==r.data.length)return t.updateKeyChildren.call(t,e,n)},updateKeySelf:function(e,n){if(0!==r.data.length)return t.updateKeySelf.call(t,e,n)},remove:function(e){if(0!==r.data.length)return t.remove.call(t,e)},append:function(e,n){if(0!==r.data.length)return t.append.call(t,e,n)},insertBefore:function(e,n){if(0!==r.data.length)return t.insertBefore.call(t,e,n)},insertAfter:function(e,n){if(0!==r.data.length)return t.insertAfter.call(t,e,n)},getChecked:function(e,n){if(0!==r.data.length)return t.getChecked.call(t,e,n)},setChecked:function(e,n){if(0!==r.data.length)return t.setChecked.call(t,e,n)},unCheckNodes:function(){if(0!==r.data.length)return t.unCheckNodes.call(t)},expandAll:function(){r.elem.children(".eleTree-node").children(".eleTree-node-group").empty(),t.expandAll.call(t,r.data,[],1,!0),t.unCheckNodes(),t.defaultChecked()},expandNode:function(e){t.expandNode.call(t,e)},unExpandAll:function(){return t.unExpandAll.call(t)},reload:function(e){return t.reload.call(t,e)},reInitData:function(e){return t.reInitData.call(t,e)},getData:function(){return t.config.data},selected:function(e){return t.selectedNode.call(t,e)},search:function(e){return t.search.call(t,e)},search2:function(e){return t.search2.call(t,e)},search3:function(e){return t.search3.call(t,e)}}},i=function(e){e.response=q.extend({},this.config.response,e.response),e.request=q.extend({},this.config.request,e.request),e.nodeIcon=q.extend({},this.config.nodeIcon,e.nodeIcon),e.leafIcon=q.extend({},this.config.leafIcon,e.leafIcon),this.config=q.extend({},this.config,e),this.prevClickEle=null,this.addKeyIndex=20181201,this.nameIndex=1,this.render()};function c(e,n,t){var r=q(n=n).parents(".ctxMenu").data("protoObj"),o=r.config.elem.find(".eleTree-node-content.eleTree-node-content-active").parent(".eleTree-node");r.reInitData(o);layui.event.call(o,x,"node"+t+"("+r.filter+")",{node:o,data:r.reInitData(o),event:e})}i.prototype={constructor:i,config:{elem:"",data:[],emptText:"暂无数据",renderAfterExpand:!0,highlightCurrent:!1,defaultExpandAll:!1,expandOnClickNode:!0,checkOnClickNode:!1,defaultExpandedKeys:[],autoExpandParent:!0,showCheckbox:!1,checkStrictly:!1,defaultCheckedKeys:[],accordion:!1,showIcon:!0,indent:16,searchFilter:!1,lazy:!1,load:function(){},draggable:!1,contextmenuList:[],skin:"",diyHoverDom:"",diyHoverDomIconShow:!1,diyHoverNodeTypes:[],diyHoverMenuList:[],searchNodeMethod:null,searchNodeMethod2:null,searchNodeMethod3:null,method:"get",url:"",contentType:"",headers:{},done:null,response:{statusName:"code",statusCode:0,dataName:"data"},request:{name:"label",key:"id",children:"children",disabled:"disabled",checked:"checked",isLeaf:"isLeaf",isdrag:"isdrag"},nodeIcon:{open:"eletree-icon-wenjianjiazhankai",close:"eletree-icon-weibiaoti5"},leafIcon:{normal:"eletree-icon-null",folder:"eletree-icon-weibiaoti5",user:"eletree-icon-yonghu",item:"eletree-icon-fenzhijigou",form:"eletree-icon-fenguangbaobiao",info:"eletree-icon-xinxipilu",leaf:"eletree-icon-shuye1",medal:"eletree-icon-caidan_xunzhang",file:"eletree-icon-normal-file"},menus:{add:{icon:"layui-icon layui-icon-add-circle",name:"新增节点",click:function(e){c(e,this,"Add")}},edit:{icon:"layui-icon layui-icon-edit",name:"编辑节点",click:function(e){c(e,this,"Edit")}},edit1:{icon:"layui-icon layui-icon-edit",name:"编辑目录",click:function(e){c(e,this,"Edit")}},remove:{icon:"layui-icon layui-icon-delete",name:"删除节点",click:function(e){c(e,this,"Remove")}},remove1:{icon:"layui-icon layui-icon-delete",name:"删除目录",click:function(e){c(e,this,"Remove")}},copy:{icon:"iconfont icon-ai-copy",name:"复制节点",click:function(e){c(e,this,"Copy")}},insertBefore:{name:"插入节点前",click:function(e){c(e,this,"InsertBefore")}},insertAfter:{name:"插入节点后",click:function(e){c(e,this,"InsertAfter")}},append:{name:"插入子节点",click:function(e){c(e,this,"Append")}}}},render:function(){30<this.config.indent?this.config.indent=30:this.config.indent<10&&(this.config.indent=10);var e=this.config;if(e.where=e.where||{},!e.elem)return o.error("缺少elem参数");e.elem="string"==typeof e.elem?q(e.elem):e.elem,this.filter=e.elem.attr("lay-filter"),e.elem.append('<div class="eleTree-loadData"><i class="layui-icon layui-icon-loading layui-icon layui-anim layui-anim-rotate layui-anim-loop"></i></div>'),e.showIcon&&this.renderDataIcon(),0===e.data.length?this.ajaxGetData():this.renderData()},renderDataIcon:function(e){var r=this.config;!function t(e){e&&e.length&&e.forEach(function(e,n){null==e.type?e.icon=r.leafIcon.file:e.icon=r.leafIcon[e.type.toLowerCase()]||r.leafIcon.file,e.children&&e.children.length&&e.children[0]&&t(e.children)})}(e||r.data)},renderData:function(){var n=this.config;T(p(n,0)).render(n.data,function(e){n.elem.html(e).children().show()}),n.lazy||(!n.renderAfterExpand||n.defaultExpandAll||0<n.defaultExpandedKeys.length||0<n.defaultCheckedKeys.length)&&this.expandAll(n.data,[],1),n.elem.off("click"),this.eleTreeEvent(),this.checkboxRender(),this.checkboxEvent(),this.defaultChecked(),this.nodeEvent(),this.rightClickMenu(),this.diyHoverDomClick(),"function"==typeof n.done&&n.done(n.data),n.checkStrictly||this.checkboxInit()},ajaxGetData:function(){var n=this.config,t=this;if(n.url){var e=q.extend({},n.where);n.contentType&&0==n.contentType.indexOf("application/json")&&(e=JSON.stringify(e)),q.ajax({type:n.method||"get",url:n.url,contentType:n.contentType,data:e,dataType:"json",headers:n.headers||{},success:function(e){if(e[n.response.statusName]!=n.response.statusCode||!e[n.response.dataName])return o.error("请检查数据格式是否符合规范"),void("function"==typeof n.done&&n.done(e));n.data=e[n.response.dataName],t.renderData(),"function"==typeof n.done&&n.done(e)}})}else T(r()).render(n,function(e){n.elem.html(e)})},reload:function(e){return this.config.data&&this.config.data.constructor===Array&&(this.config.data=[]),this.config=q.extend({},this.config,e),q(this.config.elem).off(),n.render(this.config)},eleTreeEvent:function(){var t=this,e=this.config,n=e.expandOnClickNode?".eleTree-node-content":".eleTree-node-content>.eleTree-node-content-icon:not(.eletreefont-special)";e.elem.on("click",n,function(e){e.stopPropagation();var n=0===q(this).parent(".eleTree-node").length?q(this).parent(".eleTree-node-content"):q(this);t.expandNode(n)})},selectedNode:function(e){var n=this.config;this.prevClickEle&&this.prevClickEle.removeClass("eleTree-node-content-active"),n.highlightCurrent&&e.addClass("eleTree-node-content-active"),this.prevClickEle=e},checkboxEvent:function(){var a=this.config,d=this,e=a.checkOnClickNode?".eleTree-node-content":".eleTree-checkbox";a.elem.on("click",e,function(e,n){e.stopPropagation();var t=0===q(this).parent(".eleTree-node").length?q(this).parent(".eleTree-node-content"):q(this),r=t.children(".eleTree-checkbox");if(!r.hasClass("eleTree-checkbox-disabled")){t.parent(".eleTree-node");var o=r.siblings(".eleTree-hideen").get(0),i=t.siblings(".eleTree-node-group").find("input[name='eleTree-node']");if(d.selectedNode(t),o){o.checked?(q(o).prop("checked",!1).attr("eleTree-status","0"),a.checkStrictly||(i.prop("checked",!1),i.attr("eleTree-status","0"))):(q(o).prop("checked",!0).attr("eleTree-status","1"),a.checkStrictly||i.prop("checked",!0).attr("eleTree-status","1"));var l=t.parent(".eleTree-node");if(!a.checkStrictly){var c=l.siblings(".eleTree-node");d.selectParents(o,l,c)}d.checkboxRender(),"default"!==n&&layui.event.call(o,x,"nodeChecked("+d.filter+")",{node:l,data:d.reInitData(l),isChecked:o.checked})}}})},checkboxInit:function(){var e=this.config,l=this;e.elem.find("input[eleTree-status='1']").each(function(e,n){var t=q(n).siblings(".eleTree-checkbox"),r=t.parent(".eleTree-node-content").siblings(".eleTree-node-group").find("input[name='eleTree-node']");t.addClass("eleTree-checkbox-checked"),t.children("i").addClass("layui-icon-ok").removeClass("eleTree-checkbox-line"),r.prop("checked","checked").attr("eleTree-status","1"),r.siblings(".eleTree-checkbox").addClass("eleTree-checkbox-checked"),r.siblings(".eleTree-checkbox").children("i").addClass("layui-icon-ok").removeClass("eleTree-checkbox-line");var o=t.parent(".eleTree-node-content").parent(".eleTree-node"),i=o.siblings(".eleTree-node");l.selectParents(n,o,i)}),l.checkboxRender()},expandParents:function(e){var i=this;!function e(n){var t=n.parent(".eleTree-node-group").parent(".eleTree-node");if(t[0]){var r=t.children(".eleTree-node-content"),o=r.children(".eleTree-node-content-icon").children(".layui-icon.layui-icon-triangle-r").hasClass("icon-rotate");0<t.length&&!o&&i.expandNode(r),e(r)}}(e)},selectParents:function(e,n,t){for(;0!==Number(n.attr("eletree-floor"));){var r=[];r.push(q(e).attr("eleTree-status")),t.each(function(e,n){var t=q(n).children(".eleTree-node-content").children("input[name='eleTree-node']").attr("eleTree-status");r.push(t)});var o=n.parent(".eleTree-node-group").siblings(".eleTree-node-content").children("input[name='eleTree-node']"),i=o.siblings(".eleTree-checkbox");r.every(function(e){return"1"===e})&&o.prop("checked",!0).attr("eleTree-status","1"),r.some(function(e){return"0"===e||"2"===e})&&o.attr("eleTree-status","2"),r.every(function(e){return"0"===e})&&(o.prop("checked",!1),o.attr("eleTree-status","0"));var l=n.parents("[eletree-floor='"+(Number(n.attr("eletree-floor"))-1)+"']"),c=(i=l.children(".eleTree-node-content").children("input[name='eleTree-node']").get(0),l.siblings(".eleTree-node"));n=l,e=i,t=c}},expandNode:function(e){var t=this.config,r=this,o=e,n=o.parent(".eleTree-node"),i=o.siblings(".eleTree-node-group"),l=o.children(".eleTree-node-content-icon").children(".layui-icon");if(r.selectedNode(o),l.hasClass("icon-rotate"))return i.children(".eleTree-node:not(.eleTree-search-hide)").hide("fast"),l.removeClass("icon-rotate"),void(l.parent().next(".eleTree-node-content-icon").hasClass(t.nodeIcon.open)&&l.parent().next(".eleTree-node-content-icon").removeClass(t.nodeIcon.open).addClass(t.nodeIcon.close));if(0===i.children(".eleTree-node").length){var c=Number(n.attr("eletree-floor"))+1,a=r.reInitData(n).currentData;if(t.lazy&&l.hasClass("lazy-icon"))l.removeClass("layui-icon-triangle-r").addClass("layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop"),t.load(a,function(e){r.renderDataIcon(e),a[t.request.children]=e;var n=o.children("input.eleTree-hideen").attr("eletree-status");a[t.request.children]&&0<a[t.request.children].length&&a[t.request.children][0]?T(p(t,c,n)).render(a[t.request.children],function(e){i.append(e).children().show("fast")}):l.css("color","transparent").addClass("leaf-icon"),l.removeClass("lazy-icon layui-icon-loading layui-anim layui-anim-rotate layui-anim-loop").addClass("layui-icon-triangle-r icon-rotate"),r.checkboxRender(),"function"==typeof t.done&&t.done(e)});else{var d=o.children("input.eleTree-hideen").attr("eletree-status");a[t.request.children]&&0<a[t.request.children].length&&a[t.request.children][0]&&T(p(t,c,d)).render(a[t.request.children],function(e){i.append(e)});var s=i.children(".eleTree-node").eq(0);if(0===s.length)return void r.checkboxRender();var h=s.siblings(".eleTree-node"),u=s.children(".eleTree-node-content").children(".eleTree-hideen").get(0);r.selectParents(u,s,h),r.checkboxRender()}}if(i.children(".eleTree-node:not(.eleTree-search-hide)").show("fast"),l.addClass("icon-rotate"),l.parent().next(".eleTree-node-content-icon").hasClass(t.nodeIcon.close)&&l.parent().next(".eleTree-node-content-icon").removeClass(t.nodeIcon.close).addClass(t.nodeIcon.open),t.accordion){var f=o.parent(".eleTree-node").siblings(".eleTree-node");f.children(".eleTree-node-group").children(".eleTree-node:not(.eleTree-search-hide)").hide("fast"),f.children(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").removeClass("icon-rotate"),f.children(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).hasClass(t.nodeIcon.open)&&f.children(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).removeClass(t.nodeIcon.open).addClass(t.nodeIcon.close)}},expandAll:function(e,o,i,l){var c=this.config,a=this;e.forEach(function(e,n){if(o.push(n),e[c.request.children]&&0<e[c.request.children].length&&e[c.request.children][0]){for(var t=c.elem.children(".eleTree-node").eq(o[0]).children(".eleTree-node-group"),r=1;r<o.length;r++)t=t.children(".eleTree-node").eq(o[r]).children(".eleTree-node-group");T(p(c,i)).render(e[c.request.children],function(e){if(t.append(e),c.defaultExpandAll||l)t.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").addClass("icon-rotate"),t.children(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).hasClass(c.nodeIcon.close)&&t.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).removeClass(c.nodeIcon.close).addClass(c.nodeIcon.open),t.children().show();else if(0<c.defaultExpandedKeys.length){function r(e){c.autoExpandParent&&e.parents(".eleTree-node").each(function(e,n){q(n).attr("data-"+c.request.key)&&(q(n).children(".eleTree-node-group").siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").addClass("icon-rotate"),q(n).children(".eleTree-node-group").siblings(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).hasClass(c.nodeIcon.close)&&q(n).children(".eleTree-node-group").siblings(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).removeClass(c.nodeIcon.close).addClass(c.nodeIcon.open),q(n).children(".eleTree-node-group").children().show())})}var n=t.parent(".eleTree-node").attr("data-"+c.request.key);n=isNaN(n)?n:Number(n),-1!==q.inArray(n,c.defaultExpandedKeys)?(t.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").addClass("icon-rotate"),t.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).has(c.nodeIcon.close)&&t.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).removeClass(c.nodeIcon.close).addClass(c.nodeIcon.open),t.children().show(),r(t.parent(".eleTree-node[data-"+c.request.key+"]"))):t.children(".eleTree-node").each(function(e,n){var t=q(n).attr("data-"+c.request.key);if(t=isNaN(t)?t:Number(t),-1!==q.inArray(t,c.defaultExpandedKeys))return r(q(n)),!1})}}),i++,a.expandAll(e[c.request.children],o,i,l),i--}o.pop()})},defaultChecked:function(){var o=this.config;if(0===o.defaultCheckedKeys.length)return!1;if(o.checkStrictly)return o.defaultCheckedKeys.forEach(function(e,n){var t=o.elem.find("[data-"+o.request.key+"='"+e+"']").children(".eleTree-node-content");!1===t.children(".eleTree-hideen").prop("checked")&&t.children(".eleTree-checkbox").trigger("click",["default"])}),!1;var i=q.extend([],o.defaultCheckedKeys);o.defaultCheckedKeys.forEach(function(e,n){o.elem.find("[data-"+o.request.key+"='"+e+"']").find("[data-"+o.request.key+"]").each(function(e,n){var t=q(n).attr("data-"+o.request.key);t=isNaN(t)?t:Number(t);var r=q.inArray(t,i);-1!==r&&i.splice(r,1)})}),i.forEach(function(e,n){var t=o.elem.find("[data-"+o.request.key+"='"+e+"']").children(".eleTree-node-content");!1===t.children(".eleTree-hideen").prop("checked")&&t.children(".eleTree-checkbox").trigger("click",["default"])})},checkboxRender:function(){var e=this.config;e.elem.find(".eleTree-checkbox").remove(),e.elem.find("input.eleTree-hideen[type=checkbox]").each(function(e,n){q(n).hasClass("eleTree-disabled")?q(n).after('<div class="eleTree-checkbox eleTree-checkbox-disabled"><i class="layui-icon"></i></div>'):q(n).after('<div class="eleTree-checkbox"><i class="layui-icon"></i></div>');var t=q(n).siblings(".eleTree-checkbox");"1"===q(n).attr("eletree-status")?(t.addClass("eleTree-checkbox-checked"),t.children("i").addClass("layui-icon-ok").removeClass("eleTree-checkbox-line")):"0"===q(n).attr("eletree-status")?(t.removeClass("eleTree-checkbox-checked"),t.children("i").removeClass("layui-icon-ok eleTree-checkbox-line")):"2"===q(n).attr("eletree-status")&&(t.addClass("eleTree-checkbox-checked"),t.children("i").removeClass("layui-icon-ok").addClass("eleTree-checkbox-line"))})},reInitData:function(e){for(var n=this.config,t=e.index(),r=Number(e.attr("eletree-floor")),o=[];0<=r;)o.push(t),--r,t=(e=e.parents("[eletree-floor='"+r+"']")).index();o=o.reverse();var i=this.config.data,l=i[o[0]],c=i[o[0]];for(t=1;t<o.length;t++)c=c[n.request.children]?c[n.request.children][o[t]]:c;for(t=1;t<o.length-1;t++)l=l[n.request.children]?l[n.request.children][o[t]]:l;return{currentData:c,parentData:{data:l,childIndex:o[o.length-1]},index:o}},keySearchToOpera:function(r,o){var i=this.config;!function e(n){for(var t={i:0,len:n.length};t.i<t.len;t.i++)n[t.i][i.request.key]!==r?n[t.i][i.request.children]&&0<n[t.i][i.request.children].length&&n[t.i][i.request.children][0]&&e(n[t.i][i.request.children]):o(n,t)}(i.data)},updateKeyChildren:function(e,t){var r=this.config,o=r.elem.find("[data-"+r.request.key+"='"+e+"']"),i=Number(o.attr("eletree-floor"))+1,l=this;this.keySearchToOpera(e,function(e,n){e[n.i][r.request.children]=t,0!==o.length&&T(p(r,i)).render(t,function(e){q(o).children(".eleTree-node-group").empty().append(e),r.defaultExpandAll&&q(o).children(".eleTree-node-group").children().show()}),l.unCheckNodes(),l.defaultChecked()})},updateKeySelf:function(e,t){var r=this.config,n=r.elem.find("[data-"+r.request.key+"='"+e+"']").children(".eleTree-node-content");Number(n.attr("eletree-floor"));t[r.request.name]&&n.children(".eleTree-node-content-label").text(t[r.request.name]),t[r.request.disabled]&&n.children(".eleTree-hideen").addClass("eleTree-disabled").siblings(".eleTree-checkbox").addClass("eleTree-checkbox-disabled");this.keySearchToOpera(e,function(e,n){t[r.request.key]=e[n.i][r.request.key],t[r.request.children]=e[n.i][r.request.children],e[n.i]=q.extend({},e[n.i],t),console.log(r.data)})},remove:function(t){var r=this.config,o=r.elem.find("[data-"+r.request.key+"='"+t+"']"),i=o.parent(".eleTree-node-group");this.keySearchToOpera(t,function(e,n){e.splice(n.i,1),n.i--,n.len--,0!==o.length&&r.elem.find("[data-"+r.request.key+"='"+t+"']").remove(),0===i.children(".eleTree-node").length&&i.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").css("color","transparent")}),this.unCheckNodes(),this.defaultChecked()},append:function(e,i){var l=this.config,c=l.elem.find("[data-"+l.request.key+"='"+e+"']"),a=Number(c.attr("eletree-floor"))+1;i.icon=l.leafIcon[i.type.toLowerCase()]||l.leafIcon.file,this.keySearchToOpera(e,function(e,n){e[n.i][l.request.children]?e[n.i][l.request.children].push(i):e[n.i][l.request.children]=[i];var t=e[n.i][l.request.children];1===t.length&&(c.children(".eleTree-node-content").find(".eleTree-node-content-icon .layui-icon").removeAttr("style").addClass("icon-rotate"),c.children(".eleTree-node-content").find(".eleTree-node-content-icon").eq(1).hasClass(l.nodeIcon.close)&&c.children(".eleTree-node-content").find(".eleTree-node-content-icon").eq(1).removeClass(l.nodeIcon.close).addClass(l.nodeIcon.open));var r=t.length,o=c.children(".eleTree-node-content").children("input.eleTree-hideen").attr("eletree-status");o="2"===o?"0":o,0!==c.length&&T(p(l,a,o)).render([t[r-1]],function(e){c.children(".eleTree-node-group").append(e).children().show()})}),this.checkboxRender()},insertBefore:function(e,r){var o=this.config,i=o.elem.find("[data-"+o.request.key+"='"+e+"']"),l=Number(i.attr("eletree-floor"));r.icon=o.leafIcon[r.type.toLowerCase()]||o.leafIcon.file,this.keySearchToOpera(e,function(e,n){e.splice(n.i,0,r),n.i++,n.len++;var t=0===i.parent(".eleTree-node-group").length?"0":i.parent(".eleTree-node-group").parent(".eleTree-node").children(".eleTree-node-content").children("input.eleTree-hideen").attr("eletree-status");t="2"===t?"0":t,0!==i.length&&T(p(o,l,t)).render([r],function(e){i.before(e).prev(".eleTree-node").show()})}),this.checkboxRender()},insertAfter:function(e,r){var o=this.config,i=o.elem.find("[data-"+o.request.key+"='"+e+"']"),l=Number(i.attr("eletree-floor"));r.icon=o.leafIcon[r.type.toLowerCase()]||o.leafIcon.file,this.keySearchToOpera(e,function(e,n){e.splice(n.i+1,0,r),n.i++,n.len++;var t=0===i.parent(".eleTree-node-group").length?"0":i.parent(".eleTree-node-group").parent(".eleTree-node").children(".eleTree-node-content").children("input.eleTree-hideen").attr("eletree-status");t="2"===t?"0":t,0!==i.length&&T(p(o,l,t)).render([r],function(e){q(i).after(e).next(".eleTree-node").show()})}),this.checkboxRender()},getChecked:function(e,n){var o=this.config,i=[];return n=n||!1,((e=e||!1)?o.elem.find(".layui-icon.leaf-icon").parent(".eleTree-node-content-icon").siblings("input.eleTree-hideen[eletree-status='1']"):n?o.elem.find("input.eleTree-hideen[eletree-status='1'],input.eleTree-hideen[eletree-status='2']"):o.elem.find("input.eleTree-hideen[eletree-status='1']")).each(function(e,n){var t={},r=q(n).parent(".eleTree-node-content").parent(".eleTree-node").attr("data-"+o.request.key);t[o.request.key]=r,t.elem=n,t.othis=q(n).siblings(".eleTree-checkbox").get(0),i.push(t)}),i},setChecked:function(e,n){var t=this.config;n=n||!1,this.unCheckNodes(),n?t.defaultCheckedKeys=q.extend([],e):e.forEach(function(e){-1===q.inArray(e,t.defaultCheckedKeys)&&t.defaultCheckedKeys.push(e)}),this.defaultChecked()},unCheckNodes:function(){this.config.elem.find("input.eleTree-hideen[eletree-status='1'],input.eleTree-hideen[eletree-status='2']").each(function(e,n){q(n).attr("eletree-status","0").prop("checked",!1)}),this.checkboxRender()},unExpandAll:function(){var e=this.config;e.elem.find(".layui-icon.icon-rotate").removeClass("icon-rotate").parent(".eleTree-node-content-icon").parent(".eleTree-node-content").siblings(".eleTree-node-group").children(".eleTree-node").hide(),e.elem.find(".eleTree-node-content .eleTree-node-content-icon").eq(1).hasClass(e.nodeIcon.open)&&e.elem.find(".eleTree-node-content .eleTree-node-content-icon").eq(1).removeClass(e.nodeIcon.open).addClass(e.nodeIcon.close)},nodeEvent:function(){var k=this,b=this.config;b.elem.on("click",".eleTree-node-content",function(e){var n=q(this),t=n.parent(".eleTree-node");q("#tree-menu").hide().remove(),k.selectedNode(n),layui.event.call(t,x,"nodeClick("+k.filter+")",{node:t,data:k.reInitData(t),event:e})}),b.elem.on("dblclick",".eleTree-node-content",function(e){var n=q(this),t=n.parent(".eleTree-node");q("#tree-menu").hide().remove(),k.expandNode(n),layui.event.call(t,x,"nodeDblClick("+k.filter+")",{node:t,data:k.reInitData(t),event:e})}),b.elem.on("contextmenu",".eleTree-node-content",function(e){var n=q(this).parent(".eleTree-node");layui.event.call(n,x,"nodeContextmenu("+k.filter+")",{node:n,data:k.reInitData(n),event:e})}),b.draggable&&b.elem.on("mousedown",".eleTree-node-content",function(e){var r=0,f=q(this).parent(".eleTree-node"),p=Number(f.attr("eletree-floor")),T=f.parent(".eleTree-node-group"),n=k.reInitData(f);if(e.stopPropagation(),n.currentData[b.request.isdrag]){b.elem.css("user-select","none");var v=f.clone(!0),m=f.clone(!0);v[0].id="eleTreeDragNode";e.clientX,e.clientY;q("body").append(v),v.css({display:"none",opacity:.7,position:"absolute","background-color":"#f5f5f5",width:b.elem.outerWidth(),"z-index":"99998"});var y=k.reInitData(f),g=!1;q(document).on("mousemove",function(e){if(2<++r){var n=e.clientX+10,t=e.clientY+q(document).scrollTop()-5;v.css({display:"block",left:n+"px",top:t+"px"})}}).on("mouseup",function(e){q(document).off("mousemove").off("mouseup");var n=q(e.target).parents(".eleTree-node").eq(0);v.remove(),b.elem.css("user-select","auto");var t=f.parent().get(0).isEqualNode(b.elem.get(0)),r=q(e.target).get(0).isEqualNode(b.elem.get(0));if(r&&(n=b.elem),(0!==n.parents(b.elem).length||r)&&!n.get(0).isEqualNode(f.get(0))){var o=n.attr("eletree-floor"),i=!1;if(f.find("[eletree-floor='"+o+"']").each(function(){this.isEqualNode(n.get(0))&&(i=!0)}),!i){var l=k.reInitData(n);if(layui.event.call(n,x,"nodeDrag("+k.filter+")",{current:{node:f,data:y},target:{node:n,data:l},stop:function(){g=!0}}),g)return!1;var c=y.parentData.data[b.request.children],a=y.parentData.childIndex,d=y.currentData,s=l.currentData;if(t?b.data.splice(a,1):c.splice(a,1),r?b.data.push(d):(s[b.request.children]||(s[b.request.children]=[]),s[b.request.children].push(d)),f.remove(),r){n.append(m);var h=0}else{n.children(".eleTree-node-group").append(m);h=Number(n.attr("eletree-floor"))+1}m.attr("eletree-floor",String(h)),m.children(".eleTree-node-content").css("padding-left",h*b.indent+"px");var u=p-h;m.find(".eleTree-node").each(function(e,n){var t=Number(q(n).attr("eletree-floor"))-u;q(n).attr("eletree-floor",String(t)),q(n).children(".eleTree-node-content").css("padding-left",t*b.indent+"px")}),0===T.children(".eleTree-node").length&&T.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").removeClass("icon-rotate").css("color","transparent"),T.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).hasClass(b.nodeIcon.open)&&T.siblings(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).removeClass(b.nodeIcon.open).addClass(b.nodeIcon.close),0===n.children(".eleTree-node-group").children(".eleTree-node").length||!n.children(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon").addClass("icon-rotate").removeAttr("style")||n.children(".eleTree-node-content").children(".eleTree-node-content-icon").eq(1).removeClass(b.nodeIcon.close).addClass(b.nodeIcon.open),k.unCheckNodes(),k.defaultChecked()}}})}})},rightClickMenu:function(){var d=this,s=this.config;if(!(s.contextmenuList.length<=0)){q(document).on("click",function(){q("#tree-menu").hide().remove()});var e=['<ul id="tree-menu">',-1!==q.inArray("copy",s.contextmenuList)?'<li class="copy"><a href="javascript:;">复制</a></li>':"",-1!==q.inArray("add",s.contextmenuList)?'<li class="add"><a href="javascript:;">新增</a></li><li class="insertBefore"><a href="javascript:;">插入节点前</a></li><li class="insertAfter"><a href="javascript:;">插入节点后</a></li><li class="append"><a href="javascript:;">插入子节点</a></li>':"",-1!==q.inArray("edit",s.contextmenuList)?'<li class="edit"><a href="javascript:;">修改</a></li>':"",-1!==q.inArray("remove",s.contextmenuList)?'<li class="remove"><a href="javascript:;">删除</a></li>':"","</ul>"].join("");this.treeMenu=q(e),s.diyHoverDom?s.elem.off("click.diyHoverDom").on("click.diyHoverDom",".eleTree-node-content-diydom",n):s.elem.off("contextmenu").on("contextmenu",".eleTree-node-content",n)}function n(e){var l=this;e.stopPropagation(),e.preventDefault(),d.selectedNode(q(this));var i=q(this).parent(".eleTree-node"),c=d.reInitData(i);q(document.body).after(d.treeMenu),q("#tree-menu li.insertBefore,#tree-menu li.insertAfter,#tree-menu li.append").hide(),q("#tree-menu li.copy,#tree-menu li.add,#tree-menu li.edit,#tree-menu li.remove").show(),q("#tree-menu").css({left:e.pageX,top:e.pageY}).show(),q("#tree-menu li.copy").off().on("click",function(){var e=q(l).children(".eleTree-node-content-label").get(0),n=window.getSelection(),t=document.createRange();t.selectNodeContents(e),n.removeAllRanges(),n.addRange(t),document.execCommand("Copy","false",null),n.removeAllRanges()}),q("#tree-menu li.add").off().on("click",function(e){e.stopPropagation(),q(this).hide().siblings("li.copy,li.edit,li.remove").hide(),q(this).siblings(".append,li.insertAfter,li.insertBefore").show()});var a={};a[s.request.key]=d.addKeyIndex,a[s.request.name]="未命名"+d.nameIndex;["Append","InsertBefore","InsertAfter"].forEach(function(i){var e=i[0].toLocaleLowerCase()+i.slice(1,i.length);q("#tree-menu li."+e).off().on("click",function(e){var n=q(l).parent(".eleTree-node"),t=n.attr("data-"+s.request.key);t=isNaN(t)?t:Number(t);var r=!1,o=i[0].toLocaleLowerCase()+i.slice(1,i.length);layui.event.call(n,x,"node"+i+"("+d.filter+")",{node:n,data:c.currentData,setData:function(e){d[o](t,q.extend({},a,e)),r=!0},stop:function(){r=!0}}),r||(d[o](t,a),d.nameIndex++,d.addKeyIndex++)})}),q("#tree-menu li.edit").off().on("click",function(e){e.stopPropagation(),q("#tree-menu").hide().remove();var r=q(l).parent(".eleTree-node"),n=r.attr("data-"+s.request.key);n=isNaN(n)?n:Number(n);var t=q(l).children(".eleTree-node-content-label").hide(),o="<input type='text' value='"+t.text()+"' class='eleTree-node-content-input' />";t.after(o),t.siblings(".eleTree-node-content-input").focus().select().off().on("blur",function(){var e=q(this).val(),n=!1,t=this;layui.event.call(r,x,"nodeEdit("+d.filter+")",{node:r,value:e,data:c.currentData,stop:function(){n=!0,q(t).siblings(".eleTree-node-content-label").show(),q(t).remove()}}),n||(d.reInitData(i).currentData[s.request.name]=e,q(this).siblings(".eleTree-node-content-label").text(e).show(),q(this).remove())}).on("mousedown",function(e){e.stopPropagation()})}),q("#tree-menu li.remove").off().on("click",function(e){var n=q(l).parent(".eleTree-node"),t=n.attr("data-"+s.request.key);t=isNaN(t)?t:Number(t);var r=!1;layui.event.call(n,x,"nodeRemove("+d.filter+")",{node:n,data:c.currentData,stop:function(){r=!0}}),r||d.remove(t)}),d.prevClickEle=q(this)}},getMenus:function(){var t=this,r=this.config,o=[],i=[],l=0;return r.diyHoverMenuList.length&&r.diyHoverMenuList.forEach(function(e,n){r.menus[e].protoObj=t,"insertBefore"==e||"insertAfter"==e||"append"==e?i.push(r.menus[e]):(o.push(r.menus[e]),"add"==e&&(l=n))}),i.length&&(delete o[l].click,o[l].subs=i),o},diyHoverDomClick:function(){var o=this,i=this.config;i.diyHoverDomIconShow||(i.diyHoverDom&&i.elem.off("mouseenter.diyHoverDom").on("mouseenter.diyHoverDom",".eleTree-node-content",function(e){var n=q(this),t=n.parent(".eleTree-node"),r=o.reInitData(t);(i.diyHoverNodeTypes.length<=0||0<=i.diyHoverNodeTypes.indexOf(r.currentData.type))&&n.children(".eleTree-node-content-diydom").removeClass("eleTree-hide")}),i.diyHoverDom&&i.elem.off("mouseleave.diyHoverDom").on("mouseleave.diyHoverDom",".eleTree-node-content",function(e){var n=q(this);n.parent(".eleTree-node");n.children(".eleTree-node-content-diydom").addClass("eleTree-hide")})),i.diyHoverDom&&i.elem.off("click.diyHoverDom").on("click.diyHoverDom",".eleTree-node-content-diydom",function(e){e.stopPropagation();var n=q(this).parent(),t=n.parent(".eleTree-node");o.selectedNode(n);var r=o.getMenus();l&&i.diyHoverMenuList.length?l.show(r,e.clientX,e.clientY):layui.event.call(t,x,"nodeDiyDomClick("+o.filter+")",{node:t,data:o.reInitData(t),event:e})})},search:function(h){var u=this,f=u.config;if(f.searchNodeMethod&&"function"==typeof f.searchNodeMethod){var e=f.data,p="";!function s(e){e.forEach(function(e,n){if(e.visible=f.searchNodeMethod(h,e),e[f.request.children]&&0<e[f.request.children].length&&e[f.request.children][0]&&s(e[f.request.children]),!e.visible){var t=!1;e[f.request.children]&&0<e[f.request.children].length&&e[f.request.children][0]&&(t=e[f.request.children].some(function(e,n){return e.visible})),e.visible=t}var r=f.elem.find("[data-"+f.request.key+"='"+e[f.request.key]+"']");if(f.searchFilter)if(e.visible){r.removeClass("eleTree-search-hide");var o=r.parent(".eleTree-node-group").parent(".eleTree-node"),i=o.children(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon.layui-icon-triangle-r").hasClass("icon-rotate");(0<o.length&&i||0===o.length)&&r.show()}else r.hide().addClass("eleTree-search-hide");else if(e.visible){var l=new RegExp("[\\[\\]\\\\^\\$\\.\\|\\?\\*\\+\\(\\)]","gi"),c=h.replace(l,function(e){return"\\"+e}),a=new RegExp(c,"gi"),d=e[f.request.name].replace(a,function(e){return'<span style="color: whitesmoke;background-color: darkred;">'+e+"</span>"});r[0]&&(u.expandParents(r),r.find(".eleTree-node-content-label").eq(0).html(d)),p=p||r}else r&&r.find(".eleTree-node-content-label").eq(0).html(e[f.request.name]);e[f.request.children]&&0<e[f.request.children].length&&e[f.request.children][0]&&e[f.request.children].forEach(function(e,n){delete e.visible})})}(e);var n=[];e.forEach(function(e){n.push(e.visible),delete e.visible}),p&&p.closest(".treebox-scroll").scrollTop(p[0].offsetTop),n.every(function(e){return!1===e})&&f.searchFilter?T(r()).render(f,function(e){f.elem.append(e)}):f.elem.children(".eleTree-noText").remove()}},search2:function(c){var a=this.config;if(a.searchNodeMethod2&&"function"==typeof a.searchNodeMethod2){var e=a.data,d="";!function l(e){e.forEach(function(e,n){if(e.visible=a.searchNodeMethod2(c,e),e[a.request.children]&&0<e[a.request.children].length&&e[a.request.children][0]&&l(e[a.request.children]),!e.visible){var t=!1;e[a.request.children]&&0<e[a.request.children].length&&e[a.request.children][0]&&(t=e[a.request.children].some(function(e,n){return e.visible})),e.visible=t}var r=a.elem.find("[data-"+a.request.key+"='"+e[a.request.key]+"']");if(a.searchFilter)if(e.visible){r.removeClass("eleTree-search-hide");var o=r.parent(".eleTree-node-group").parent(".eleTree-node"),i=o.children(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon.layui-icon-triangle-r").hasClass("icon-rotate");(0<o.length&&i||0===o.length)&&r.show()}else r.hide().addClass("eleTree-search-hide");else e.visible?d=d||r:r&&r.find(".eleTree-node-content-label").eq(0).html(e[a.request.name]);e[a.request.children]&&0<e[a.request.children].length&&e[a.request.children][0]&&e[a.request.children].forEach(function(e,n){delete e.visible})})}(e);var n=[];e.forEach(function(e){n.push(e.visible),delete e.visible}),d&&d.closest(".treebox-scroll").scrollTop(d[0].offsetTop),n.every(function(e){return!1===e})&&a.searchFilter?T(r()).render(a,function(e){a.elem.append(e)}):a.elem.children(".eleTree-noText").remove()}},search3:function(c){var a=this.config;if(a.searchNodeMethod3&&"function"==typeof a.searchNodeMethod3){var e=a.data,d="";!function l(e){e.forEach(function(e,n){if(e.visible=a.searchNodeMethod3(c,e),e[a.request.children]&&0<e[a.request.children].length&&e[a.request.children][0]&&l(e[a.request.children]),!e.visible){var t=!1;e[a.request.children]&&0<e[a.request.children].length&&e[a.request.children][0]&&(t=e[a.request.children].some(function(e,n){return e.visible})),e.visible=t}var r=a.elem.find("[data-"+a.request.key+"='"+e[a.request.key]+"']");if(a.searchFilter)if(e.visible){r.removeClass("eleTree-search-hide");var o=r.parent(".eleTree-node-group").parent(".eleTree-node"),i=o.children(".eleTree-node-content").children(".eleTree-node-content-icon").children(".layui-icon.layui-icon-triangle-r").hasClass("icon-rotate");(0<o.length&&i||0===o.length)&&r.show()}else r.hide().addClass("eleTree-search-hide");else e.visible?d=d||r:r&&r.find(".eleTree-node-content-label").eq(0).html(e[a.request.name]);e[a.request.children]&&0<e[a.request.children].length&&e[a.request.children][0]&&e[a.request.children].forEach(function(e,n){delete e.visible})})}(e);var n=[];e.forEach(function(e){n.push(e.visible),delete e.visible}),d&&(d.closest(".treebox-scroll").scrollTop(d[0].offsetTop),q(d).find(".eleTree-node-content").eq(0).addClass("eleTree-node-content-active")),n.every(function(e){return!1===e})&&a.searchFilter?T(r()).render(a,function(e){a.elem.append(e)}):a.elem.children(".eleTree-noText").remove()}}},layui.link(layui.cache.base+"eleTree/eleTree.css"),layui.link(layui.cache.base+"eleTree/font/eletreefont.css"),e(x,n)});